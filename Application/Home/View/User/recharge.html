<extend name="Public:base"/>
<block name="style">
    <style>
        .form-group{
            display: inline-block;
            width: 100%;
            margin-top: 15px;
        }
        .widget-body{
            display: inline-block;
            width: 100%;
            height: 450px;
        }
        .save_info{
            float: right;
            margin-right: 45%;
            margin-top: 7%;
        }
        .form_label{
            display: inline-block;
            max-width: 100%;
            margin-bottom: 0px;
            line-height: 34px;
        }
        .form_text{
            width: 40%;
            display: inline-block;
        }
        #remarks{
            margin: 0px;
            width: 40%;
            height: 104px;
        }
    </style>
</block>
<block name="main">
    <div class="col-lg-12 col-sm-12 col-xs-12">
        <div class="widget flat">
            <div class="widget-header">
                <span class="widget-caption">基本信息修改</span>
            </div><!--Widget Header-->
            <div class="widget-body">
                <div class="form-group">
                    <label class="col-sm-2 control-label text-align-right form_label">选择产品：</label>
                    <select id="product" class="form_text" data="{$product}">
                        <option value="">请选择产品</option>
                        <foreach name="product_list" item="vo" >
                            <option value="{$vo.id}">{$vo.name}</option>
                        </foreach>
                    </select>
                </div>
                <div class="form-group">
                    <label for="money" class="col-sm-2 control-label text-align-right form_label">充值金额（元）：</label>
                    <input type="number" min="0.01" placeholder="请输入充值金额" class="form-control form_text" name="money" id="money">
                </div>
                <div class="form-group">
                    <label for="remarks" class="col-sm-2 control-label text-align-right form_label">备注：</label>
                    <textarea id="remarks" maxlength="100" placeholder="请填写备注(100字符)"></textarea>
                </div>
                <a class="btn btn-blue shiny save_info" to-url="{:U('User/prepaid_records')}" url="{:U('User/recharge_handle')}">充值</a>
            </div><!--Widget Body-->
        </div><!--Widget-->
    </div>
</block>
<block name="script">
    <script>
        $(function(){
            $('.save_info').click(function(){
                var product_id = $.trim($("#product").val());
                var money = $.trim($("#money").val());
                var remarks = $.trim($("#remarks").val());
                console.log(money);
                if(product_id==''){
                    $("#product").focus();
                    hint('warning','提示','请选择产品');
                    return;
                }
                if(money==''){
                    $("#money").focus();
                    hint('warning','提示','请输入充值金额');
                    return;
                }
                if(isNaN(money)||money<0.01){
                    $("#money").focus();
                    hint('warning','提示','金额输入不合法！');
                    return;
                }
                var url = $(this).attr('url');
                var to_url = $(this).attr('to-url');
                $.post(
                    url,
                    {
                        product_id:product_id,
                        money:money,
                        remarks:remarks,
                    },function(data){
                        if(data['code']==0){
                            hint('success',data['msg'],data['data']);
                            setTimeout(function(){
                                window.location.href=to_url;
                            },1000)
                        }else if(data['code']==1){
                            hint('warning',data['msg'],data['data']);
                        }else if(data['code']==2){
                            hint('warning',data['msg'],data['data']);
                        }
                    }
                )
            })
        })
    </script>
</block>